- name: Validate user-input variables
  assert:
    that:
      - user_list is iterable

- name: Validate the user list (including the admin user)
  assert:
    that:
      - item is mapping
      - item.name is defined and item.name is string and item.name is match(linux_user_regexp)
      - item.uid is defined and item.uid is integer and item.uid >= 1000
  with_items: '{{ [admin_user] + user_list }}'

- name: Validate the admin userâ€™s specific properties
  assert:
    that:
      - admin_user.pubkey is none or (admin_user.pubkey is string and admin_user.pubkey|length)
